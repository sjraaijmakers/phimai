---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Hero from '../components/Hero.astro';
import Gallery from '../components/Properties.astro';
import About from '../components/About.astro';
import Contact from '../components/Contact.astro';
import Footer from '../components/Footer.astro';
---

<Layout title="Phimai Pound House - Cozy Tiny Homes in Thailand">
  <Header />
  <main>
    <Hero />
    <Gallery />
    <About />
    <Contact />
  </main>
  <Footer />
</Layout>

<script>
  // Mobile menu functionality
  document.addEventListener('DOMContentLoaded', () => {
    const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    const navLinks = document.querySelector('.nav-links');

    if (mobileMenuToggle && navLinks) {
      mobileMenuToggle.addEventListener('click', () => {
        navLinks.classList.toggle('mobile-active');
        mobileMenuToggle.classList.toggle('active');
      });
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          const headerHeight = document.querySelector('.header')?.offsetHeight || 0;
          const targetPosition = target.offsetTop - headerHeight - 20;
          
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
          });
        }
      });
    });

    // Active navigation highlighting
    const sections = document.querySelectorAll('section[id]');
    const navLinks2 = document.querySelectorAll('.nav-links a');
    
    function updateActiveNav() {
      const scrollPosition = window.scrollY + 150;
      
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.offsetHeight;
        const sectionId = section.getAttribute('id');
        
        if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
          navLinks2.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${sectionId}` || (sectionId === 'gallery' && link.getAttribute('href') === '#gallery')) {
              link.classList.add('active');
            }
          });
        }
      });
    }

    // Set initial active state on page load
    window.addEventListener('load', () => {
      setTimeout(() => {
        updateActiveNav();
      }, 100);
    });

    // Header background on scroll
    let lastScrollTop = 0;
    const header = document.querySelector('.header');
    
    window.addEventListener('scroll', () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      
      updateActiveNav();
      
      if (header) {
        if (scrollTop > 100) {
          header.style.background = 'rgba(255, 255, 255, 0.98)';
          header.style.backdropFilter = 'blur(20px)';
        } else {
          header.style.background = 'rgba(255, 255, 255, 0.95)';
          header.style.backdropFilter = 'blur(10px)';
        }
      }
      
      lastScrollTop = scrollTop;
    });

    // Set initial active nav
    updateActiveNav();

    // Gallery lightbox functionality - using the same gallery images from the configuration
    const galleryImages = [
      {
        src: "/images/tiny-home-exterior.jpg",
        alt: "Cozy tiny home exterior",
        description: "Our charming tiny home exterior with modern design"
      },
      {
        src: "/images/interior-living.jpg",
        alt: "Tiny home interior living space",
        description: "Comfortable living area with all essentials"
      },
      {
        src: "/images/phimai-temple.jpg",
        alt: "Phimai Historical Park nearby",
        description: "Ancient Khmer temple ruins just minutes away"
      },
      {
        src: "/images/family-suite.jpg",
        alt: "Family suite accommodation",
        description: "Spacious family accommodation for larger groups"
      },
      {
        src: "/images/kitchenette.jpg",
        alt: "Kitchenette with essentials",
        description: "Fully equipped kitchenette for your convenience"
      },
      {
        src: "/images/bedroom.jpg",
        alt: "Comfortable bedroom space",
        description: "Cozy bedroom with quality linens"
      },
      {
        src: "/images/free-bikes.jpg",
        alt: "Free bikes for exploring",
        description: "Complimentary bikes to explore Phimai at your own pace"
      },
      {
        src: "/images/sai-ngam-mangrove.jpg",
        alt: "Sai Ngam mangrove area",
        description: "Beautiful mangrove forest perfect for nature walks"
      },
      {
        src: "/images/PHOTO-2025-08-01-07-20-25 2.jpg",
        alt: "Additional property view",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-07-23-55.jpg",
        alt: "Property detail",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-07-23-55 2.jpg",
        alt: "Property feature",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-07-23-55 3.jpg",
        alt: "Property amenity",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-07-23-56.jpg",
        alt: "Property view",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-07-23-56 2.jpg",
        alt: "Property detail",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-07-23-56 3.jpg",
        alt: "Property feature",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-07-26-50.jpg",
        alt: "Property amenity",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-07-27-20.jpg",
        alt: "Property view",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-11-18.jpg",
        alt: "Property detail",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-11-26.jpg",
        alt: "Property feature",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-11-45.jpg",
        alt: "Property amenity",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-12-08.jpg",
        alt: "Property view",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-12-33.jpg",
        alt: "Property detail",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-12-55.jpg",
        alt: "Property feature",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-13-15.jpg",
        alt: "Property amenity",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-14-44.jpg",
        alt: "Property view",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-15-02.jpg",
        alt: "Property detail",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-15-36.jpg",
        alt: "Property feature",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-15-54.jpg",
        alt: "Property amenity",
        description: ""
      },
      {
        src: "/images/PHOTO-2025-08-01-13-20-44.jpg",
        alt: "Property view",
        description: ""
      }
    ];

    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const lightboxText = document.getElementById('lightbox-text');
    const closeBtn = document.querySelector('.lightbox-close');
    const prevBtn = document.querySelector('.lightbox-prev');
    const nextBtn = document.querySelector('.lightbox-next');
    
    let currentImageIndex = 0;

    function openLightbox(index) {
      currentImageIndex = index;
      const image = galleryImages[index];
      lightboxImage.src = image.src;
      lightboxImage.alt = image.alt;
      lightboxText.textContent = image.description || '';
      lightbox.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      lightbox.classList.remove('active');
      document.body.style.overflow = '';
    }

    function showPrevImage() {
      currentImageIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
      openLightbox(currentImageIndex);
    }

    function showNextImage() {
      currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
      openLightbox(currentImageIndex);
    }

    // Add click listeners to gallery items
    document.querySelectorAll('.gallery-item, .gallery-thumb').forEach(item => {
      item.addEventListener('click', () => {
        const index = parseInt(item.dataset.index);
        openLightbox(index);
      });
    });

    // Lightbox controls
    closeBtn.addEventListener('click', closeLightbox);
    prevBtn.addEventListener('click', showPrevImage);
    nextBtn.addEventListener('click', showNextImage);

    // Close lightbox when clicking outside image
    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!lightbox.classList.contains('active')) return;
      
      switch(e.key) {
        case 'Escape':
          closeLightbox();
          break;
        case 'ArrowLeft':
          showPrevImage();
          break;
        case 'ArrowRight':
          showNextImage();
          break;
      }
    });

    // Contact form handling
    const contactForm = document.querySelector('.contact-form');
    if (contactForm) {
      contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        alert('Thank you for your message! I\'ll get back to you within 1 hour.');
        contactForm.reset();
      });
    }

    // Intersection Observer for animations
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('fade-in');
        }
      });
    }, observerOptions);

    // Observe elements for animation
    document.querySelectorAll('.property-card, .review-card, .about-text, .contact-info').forEach(el => {
      observer.observe(el);
    });
  });
</script>

<style>
  /* Mobile menu styles */
  @media (max-width: 768px) {
    .nav-links.mobile-active {
      display: flex;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      flex-direction: column;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border-radius: 0 0 20px 20px;
    }

    .mobile-menu-toggle.active span:nth-child(1) {
      transform: rotate(-45deg) translate(-5px, 6px);
    }

    .mobile-menu-toggle.active span:nth-child(2) {
      opacity: 0;
    }

    .mobile-menu-toggle.active span:nth-child(3) {
      transform: rotate(45deg) translate(-5px, -6px);
    }
  }
</style>
</Layout>