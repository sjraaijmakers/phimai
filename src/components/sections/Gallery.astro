---
import { t } from 'i18next';
import { galleryImages } from '../../data/images';
import Lightbox from '../ui/Lightbox.astro';
import { Image } from 'astro:assets';

// Limit gallery to 6 images
const MAX_GALLERY_IMAGES = 6;
const limitedGalleryImages = galleryImages.slice(0, MAX_GALLERY_IMAGES);
---

<!-- Gallery Content -->
<div class="section-header">
  <h2 class="section-title">{t('gallery.title')}</h2>
  <p class="section-subtitle">{t('gallery.subtitle')}</p>
</div>

<div class="gallery-grid">
  {
    limitedGalleryImages.map((image, index) => (
      <div
        class="gallery-item"
        data-index={index}
        data-lightbox-id="gallery-lightbox"
      >
        <Image
          src={image.src}
          alt={image.captionKey ? t(image.captionKey) : ''}
          width={400}
          height={300}
          format="webp"
          quality={80}
        />
      </div>
    ))
  }
</div>

<Lightbox id="gallery-lightbox" images={galleryImages} />

<script>
  // Gallery lightbox functionality
  document.addEventListener('DOMContentLoaded', () => {
    console.log('Gallery script loaded');
    const galleryItems = document.querySelectorAll('.gallery-item');
    console.log('Found gallery items:', galleryItems.length);

    galleryItems.forEach((item, index) => {
      item.addEventListener('click', e => {
        console.log('Gallery item clicked:', index);
        const target = e.currentTarget as HTMLElement;
        const lightboxId = target.dataset.lightboxId;
        const imageIndex = parseInt(target.dataset.index || '0');

        console.log('Lightbox data:', {
          lightboxId,
          imageIndex,
          openLightbox: !!window.openLightbox,
        });

        if (lightboxId && window.openLightbox) {
          window.openLightbox(imageIndex, lightboxId);
        } else {
          console.error('Lightbox not available:', {
            lightboxId,
            openLightbox: !!window.openLightbox,
          });
        }
      });
    });
  });
</script>

<style>
  /* ===== GALLERY CONTENT STYLES ===== */
  .section-header {
    text-align: center;
    margin-bottom: var(--space-3xl);
  }

  .section-title {
    margin-bottom: var(--space-lg);
  }

  .section-subtitle {
    color: var(--color-text-light);
    max-width: 600px;
    margin: 0 auto;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-lg);
    position: relative;
    z-index: 2;
  }

  .gallery-item {
    position: relative;
    border-radius: var(--radius);
    overflow: hidden;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--shadow-md);
  }

  .gallery-item img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  /* ===== RESPONSIVE DESIGN ===== */
  @media (max-width: var(--breakpoint-sm)) {
    .gallery-grid {
      grid-template-columns: 1fr;
      gap: var(--space);
    }

    .gallery-item img {
      height: 200px;
    }
  }
</style>
