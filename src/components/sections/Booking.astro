---
import { useTranslations, getLangFromUrl } from '../../i18n/ui';
import { ArrowRight } from 'lucide-astro';
import { siteConfig } from '../../config/site';

// Get i18n translations
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Build providers list from unified config map
const providers = Object.entries(siteConfig.booking || {})
  .map(([key, value]) => {
    const v = value as any;
    if (!v || typeof v !== 'object') return null;
    return {
      key,
      name: v.name,
      href: v.url as string,
      logo: v.logo,
      i18nKey: `booking.${key}`,
      className: v.className,
      disabled: !v.url || !!v.disabled,
    };
  })
  .filter((p): p is NonNullable<typeof p> => p !== null)
  .sort((a, b) => a.name.localeCompare(b.name));
---

<section id="booking" class="booking section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title" data-i18n-key="booking.title">{t('booking.title')}</h2>
      <p class="section-subtitle" data-i18n-key="booking.subtitle">{t('booking.subtitle')}</p>
    </div>

    <div class="booking-options">
      {providers.map((p) => (
        p.disabled ? (
          <div class={`booking-option btn ${p.className} disabled`} aria-disabled="true">
            <div class="booking-logo">
              <img src={p.logo} alt={p.name} class="logo-image" />
            </div>
            <div class="booking-content">
              <span data-i18n-key={p.i18nKey}>{t(p.i18nKey)}</span>
            </div>
            <div class="booking-arrow">
              <ArrowRight size={20} />
            </div>
          </div>
        ) : (
          <a href={p.href} class={`booking-option btn ${p.className}`} target="_blank" rel="noopener noreferrer">
            <div class="booking-logo">
              <img src={p.logo} alt={p.name} class="logo-image" />
            </div>
            <div class="booking-content">
              <span data-i18n-key={p.i18nKey}>{t(p.i18nKey)}</span>
            </div>
            <div class="booking-arrow">
              <ArrowRight size={20} />
            </div>
          </a>
        )
      ))}
    </div>
  </div>
</section>


