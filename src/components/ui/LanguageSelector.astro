---
import Select from './Select.astro';
import { languages, defaultLang } from '../../i18n/ui';

// Define language options with flags
const languageOptions = [
  { value: 'en', label: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
  { value: 'th', label: 'à¹„à¸—à¸¢', flag: 'ðŸ‡¹ðŸ‡­' }
];

// Get current language from client-side
const currentLang = defaultLang;
---

<div class="language-selector">
  <Select
    id="language-select"
    options={languageOptions}
    selectedValue={currentLang}
    className="language-selector__custom"
  />
</div>

<script>
  import { setLanguage, getCurrentLanguage } from '../../i18n/client';

  // Language switching
  document.addEventListener('DOMContentLoaded', () => {
    const languageSelect = document.getElementById('language-select') as any; // Shoelace sl-select
    
    if (!languageSelect) return;

    // Set initial language from localStorage
    const currentLang = getCurrentLanguage();
    languageSelect.value = currentLang;

    // Handle language change
    languageSelect.addEventListener('sl-change', (e: any) => {
      const selectedLang = e.target.value;
      setLanguage(selectedLang);
    });

    // Listen for language changes from other components
    window.addEventListener('languageChanged', (e: any) => {
      languageSelect.value = e.detail.language;
    });
  });
</script>

<style>
  .language-selector {
    display: flex;
    align-items: center;
  }

  .language-selector__custom {
    /* Inherit styles from Select component */
  }
</style>


