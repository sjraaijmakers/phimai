---
import { siteConfig } from '../config/site';
import { galleryImages } from '../data/images';
import Lightbox from './Lightbox.astro';
import { Landmark, TreePine, Users } from 'lucide-astro';

const maxImages = 5;
---

<section id="gallery" class="properties section">
  <div class="container">
    <div class="properties-content">
      <div class="section-header">
        <h2 class="section-title" data-i18n="gallery.title" />
        <p class="section-subtitle" data-i18n="gallery.subtitle" />
      </div>

      <div class="gallery-grid">
        {galleryImages.slice(0, maxImages).map((image, index) => (
          <div class={`gallery-item ${index === 0 ? 'featured' : ''}`} data-index={index}>
            <img src={`/images/${image.filename}`} alt={image.alt} />
          </div>
        ))}
      </div>
      
      {galleryImages.length > maxImages && (
        <div class="gallery-more">
          <button class="btn btn-secondary" onclick="showMoreImages()">
            <span data-i18n="gallery.showMore" />
          </button>
        </div>
      )}

      <div class="location-section">
        <div class="location-info">
          <h3 data-i18n="gallery.location.title" />
          <p data-i18n="gallery.location.description" />
          
          <div class="location-features">
            <div class="location-feature">
              <div class="feature-icon">
                <Landmark size={16} />
              </div>
              <span data-i18n="gallery.location.features.temple" />
            </div>
            <div class="location-feature">
              <div class="feature-icon">
                <TreePine size={16} />
              </div>
              <span data-i18n="gallery.location.features.mangrove" />
            </div>
            <div class="location-feature">
              <div class="feature-icon">
                <Users size={16} />
              </div>
              <span data-i18n="gallery.location.features.culture" />
            </div>
          </div>
        </div>

        <div class="location-map">
          <iframe 
            class="map-iframe"
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3825.5!2d102.5!3d15.2!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMTXCsDEyJzAwLjAiTiAxMDLCsDMwJzAwLjAiRQ!5e0!3m2!1sen!2sth!4v1234567890"
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade">
          </iframe>
        </div>
      </div>
    </div>
  </div>
</section>

      <Lightbox images={galleryImages} />

  <script define:vars={{ galleryImages, maxImages }}>
  // Gallery functionality
  document.addEventListener('DOMContentLoaded', () => {
    // Gallery click handlers
    const galleryItems = document.querySelectorAll('.gallery-item');
    galleryItems.forEach((item, index) => {
      item.addEventListener('click', () => {
        (window as any).openLightbox(index);
      });
    });

    // Show more images functionality
    (window as any).showMoreImages = function() {
      const galleryGrid = document.querySelector('.gallery-grid');
      const showMoreBtn = document.querySelector('.gallery-more');
      
      if (galleryGrid) {
        // Add all remaining images to the grid
        const currentItems = galleryGrid.querySelectorAll('.gallery-item');
        const totalImages = galleryImages.length;
        
        for (let i = currentItems.length; i < totalImages; i++) {
          const newItem = document.createElement('div');
          newItem.className = 'gallery-item';
          newItem.setAttribute('data-index', i.toString());
          
          const img = document.createElement('img');
          img.src = `/images/${galleryImages[i].filename}`;
          img.alt = galleryImages[i].alt;
          
          newItem.appendChild(img);
          galleryGrid.appendChild(newItem);
          
          // Add click handler for new item
          newItem.addEventListener('click', () => {
            (window as any).openLightbox(i);
          });
        }
        
        galleryGrid.classList.add('expanded');
        if (showMoreBtn) {
          (showMoreBtn as HTMLElement).style.display = 'none';
        }
      }
    };
  });
</script>

